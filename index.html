<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Спокойной ночи, любимая</title>
    <style>
        /* CSS-переменные для легкой настройки */
        :root {
            --gradient-1: #1a0b41;
            --gradient-2: #4a154b;
            --gradient-3: #0c2d48;
            --gradient-4: #1c2e4a;
            --title-color: #ffd6ff;
            --heart-color: #ff6b9d;
            --heart-shadow: #ff2975;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            height: 100vh;
            background: linear-gradient(-45deg, var(--gradient-1), var(--gradient-2), var(--gradient-3), var(--gradient-4));
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            /* Улучшение производительности анимации */
            will-change: background-position;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            text-align: center;
            z-index: 2;
            animation: fadeIn 2s ease;
            position: relative;
            top: -45px;
            /* Улучшение производительности анимации */
            will-change: opacity, transform;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h1 {
            color: var(--title-color);
            font-size: 3.5rem;
            text-shadow: 0 0 15px var(--heart-shadow);
            margin-bottom: 30px;
            animation: pulse 4s infinite;
            /* Улучшение производительности анимации */
            will-change: text-shadow;
        }
        
        p {
            color: #e0d0ff;
            font-size: 1.8rem;
            line-height: 1.6;
            margin-bottom: 30px;
            animation: textFloat 8s infinite ease-in-out;
            /* Улучшение производительности анимации */
            will-change: transform;
        }
        
        .heart {
            color: var(--heart-color);
            font-size: 6rem;
            animation: beat 1.2s infinite;
            display: inline-block;
            text-shadow: 0 0 20px var(--heart-shadow);
            cursor: pointer;
            transition: transform 0.3s;
            /* Улучшение производительности анимации */
            will-change: transform;
        }
        
        .heart:hover {
            transform: scale(1.3);
        }
        
        @keyframes beat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        @keyframes pulse {
            0%, 100% { text-shadow: 0 0 15px #ff85c0; }
            50% { text-shadow: 0 0 30px var(--heart-shadow), 0 0 60px #ff85c0; }
        }
        
        @keyframes textFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .moon {
            position: absolute;
            top: 10%;
            right: 15%;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #fff8e6 10%, #ffeb99 70%);
            border-radius: 50%;
            box-shadow: 0 0 40px #fff8e6;
            animation: float 6s infinite ease-in-out;
            /* Улучшение производительности анимации */
            will-change: transform;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle var(--duration) infinite ease-in-out;
            /* Улучшение производительности анимации */
            will-change: opacity, transform;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }

        .message {
            margin-top: 20px;
            font-size: 1.2rem;
            color: #a3d9ff;
            opacity: 1;
            transition: opacity 0.5s ease;
        }
        
        .flower-field {
            position: fixed;
            top: 65vh;
            left: 0;
            width: 100%;
            height: 0;
            overflow: visible;
            z-index: 1;
            transition: height 3s ease-out;
            background: linear-gradient(to top, rgba(34, 139, 34, 0.1) 0%, transparent 100%);
            /* Улучшение производительности */
            will-change: height;
        }
        
        .flower-field.show {
            height: 50vh;
        }
        
        .flower {
            position: absolute;
            opacity: 0;
            transform: translateY(20px) scale(0.8);
            transform-origin: bottom center;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.4));
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            /* Улучшение производительности */
            will-change: opacity, transform;
        }
        
        .flower.bloom {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        .flower svg {
            overflow: visible;
            display: block; /* Убирает лишние отступы */
        }
        
        @keyframes sway {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }
        
        .flower.sway {
            animation: sway 4s ease-in-out infinite;
            will-change: transform;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 2.5rem; }
            p { font-size: 1.4rem; }
            .moon { width: 60px; height: 60px; top: 5%; right: 10%; }
            .heart { font-size: 4.5rem; }
        }
    </style>
</head>
<body>
    <div class="moon"></div>
    
    <div class="container">
        <h1 id="title">Спокойной ночи, дорогая</h1>
        <div class="heart" id="heart">❤</div>
        <div class="message">Нажми на сердце ❤</div>
    </div>
    
    <div class="flower-field" id="flowerField"></div>

    <script>
        // Оптимизация: DOMContentLoaded гарантирует, что скрипт запустится после загрузки HTML
        document.addEventListener('DOMContentLoaded', () => {
            const heart = document.getElementById('heart');
            const title = document.getElementById('title');
            const flowerField = document.getElementById('flowerField');
            const messageElement = document.querySelector('.message');

            // Оптимизация: Создаем звезды и цветы через DocumentFragment
            const createElementsInFragment = (count, className, setup) => {
                const fragment = document.createDocumentFragment();
                for (let i = 0; i < count; i++) {
                    const el = document.createElement('div');
                    el.className = className;
                    setup(el, i);
                    fragment.appendChild(el);
                }
                return fragment;
            };

            // Создаем звезды
            const starsFragment = createElementsInFragment(150, 'star', (star) => {
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                const size = `${Math.random() * 3 + 1}px`;
                star.style.width = size;
                star.style.height = size;
                star.style.setProperty('--duration', `${Math.random() * 3 + 2}s`);
                star.style.animationDelay = `${Math.random() * 5}s`;
            });
            document.body.appendChild(starsFragment);

            // Шаблоны SVG цветов (без изменений)
            const flowerTemplates = [
                `<svg viewBox="0 0 120 120" width="90" height="90"><defs><radialGradient id="roseGrad1" cx="50%" cy="40%" r="60%"><stop offset="0%" style="stop-color:#FFE4E1"/><stop offset="30%" style="stop-color:#FFB6C1"/><stop offset="70%" style="stop-color:#FF69B4"/><stop offset="100%" style="stop-color:#DC143C"/></radialGradient><radialGradient id="roseCenter" cx="50%" cy="50%" r="30%"><stop offset="0%" style="stop-color:#FF1493"/><stop offset="100%" style="stop-color:#8B0000"/></radialGradient></defs><path d="M60 30 Q40 20 25 40 Q20 60 40 75 Q60 80 80 75 Q100 60 95 40 Q80 20 60 30 Z" fill="url(#roseGrad1)" opacity=".9"/><path d="M60 30 Q45 25 35 45 Q30 65 50 75 Q70 80 85 70 Q95 55 90 40 Q75 25 60 30 Z" fill="url(#roseGrad1)" opacity=".8" transform="rotate(20 60 55)"/><path d="M60 30 Q45 25 35 45 Q30 65 50 75 Q70 80 85 70 Q95 55 90 40 Q75 25 60 30 Z" fill="url(#roseGrad1)" opacity=".7" transform="rotate(-20 60 55)"/><path d="M60 40 Q50 35 45 50 Q42 65 60 70 Q78 65 75 50 Q70 35 60 40 Z" fill="#FF69B4" opacity=".9"/><path d="M60 40 Q50 35 45 50 Q42 65 60 70 Q78 65 75 50 Q70 35 60 40 Z" fill="#FF1493" opacity=".8" transform="rotate(30 60 55)"/><path d="M60 40 Q50 35 45 50 Q42 65 60 70 Q78 65 75 50 Q70 35 60 40 Z" fill="#FF1493" opacity=".7" transform="rotate(-30 60 55)"/><circle cx="60" cy="55" r="12" fill="url(#roseCenter)"/><circle cx="60" cy="55" r="6" fill="#8B0000"/></svg>`,
                `<svg viewBox="0 0 100 120" width="75" height="90"><defs><linearGradient id="tulipGrad1" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#FFE4E1"/><stop offset="50%" stop-color="#FF69B4"/><stop offset="100%" stop-color="#DC143C"/></linearGradient><linearGradient id="tulipGrad2" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#FFFACD"/><stop offset="50%" stop-color="#FFD700"/><stop offset="100%" stop-color="#FF8C00"/></linearGradient><linearGradient id="tulipGrad3" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#E6E6FA"/><stop offset="50%" stop-color="#9370DB"/><stop offset="100%" stop-color="#4B0082"/></linearGradient></defs><path d="M50 25 Q30 15 20 40 Q15 65 50 75 Q85 65 80 40 Q70 15 50 25 Z" fill="url(#tulipGrad1)"/><path d="M50 25 Q35 20 25 45 Q20 70 50 75 Q80 70 75 45 Q65 20 50 25 Z" fill="url(#tulipGrad2)" opacity=".8" transform="rotate(15 50 50)"/><path d="M50 25 Q35 20 25 45 Q20 70 50 75 Q80 70 75 45 Q65 20 50 25 Z" fill="url(#tulipGrad3)" opacity=".6" transform="rotate(-15 50 50)"/><path d="M30 35 Q25 50 35 65" stroke="#8B0000" stroke-width="1" fill="none" opacity=".3"/><path d="M70 35 Q75 50 65 65" stroke="#8B0000" stroke-width="1" fill="none" opacity=".3"/><ellipse cx="45" cy="40" rx="3" ry="8" fill="#fff" opacity=".4"/></svg>`,
                `<svg viewBox="0 0 120 120" width="80" height="80"><defs><radialGradient id="daisyCenter" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#FFFACD"/><stop offset="50%" stop-color="#FFD700"/><stop offset="100%" stop-color="#DAA520"/></radialGradient><linearGradient id="petalGrad" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fff"/><stop offset="80%" stop-color="#F8F8FF"/><stop offset="100%" stop-color="#E6E6FA"/></linearGradient></defs><g transform="translate(60,60)"><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(0)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(22.5)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(45)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(67.5)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(90)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(112.5)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(135)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(157.5)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(180)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(202.5)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(225)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(247.5)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(270)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(292.5)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(315)"/><ellipse cx="0" cy="-25" rx="6" ry="18" fill="url(#petalGrad)" transform="rotate(337.5)"/></g><circle cx="60" cy="60" r="15" fill="url(#daisyCenter)"/><circle cx="58" cy="58" r="3" fill="#DAA520" opacity=".6"/><circle cx="62" cy="58" r="2" fill="#DAA520" opacity=".6"/><circle cx="60" cy="62" r="2.5" fill="#DAA520" opacity=".6"/><circle cx="57" cy="61" r="1.5" fill="#B8860B" opacity=".8"/><circle cx="63" cy="61" r="1.5" fill="#B8860B" opacity=".8"/></svg>`,
                `<svg viewBox="0 0 80 140" width="60" height="105"><defs><linearGradient id="lavenderGrad" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#E6E6FA"/><stop offset="30%" stop-color="#DDA0DD"/><stop offset="70%" stop-color="#9370DB"/><stop offset="100%" stop-color="#663399"/></linearGradient></defs><ellipse cx="40" cy="70" rx="12" ry="35" fill="url(#lavenderGrad)"/><circle cx="35" cy="45" r="2.5" fill="#9370DB"/><circle cx="45" cy="47" r="2.5" fill="#8A2BE2"/><circle cx="38" cy="50" r="2" fill="#9370DB"/><circle cx="42" cy="52" r="2" fill="#8A2BE2"/><circle cx="36" cy="55" r="2.5" fill="#9370DB"/><circle cx="44" cy="57" r="2.5" fill="#8A2BE2"/><circle cx="39" cy="60" r="2" fill="#9370DB"/><circle cx="41" cy="62" r="2" fill="#8A2BE2"/><circle cx="37" cy="65" r="2.5" fill="#9370DB"/><circle cx="43" cy="67" r="2.5" fill="#8A2BE2"/><circle cx="40" cy="70" r="2" fill="#9370DB"/><circle cx="38" cy="72" r="2" fill="#8A2BE2"/><circle cx="42" cy="74" r="2" fill="#9370DB"/><circle cx="39" cy="77" r="2.5" fill="#8A2BE2"/><circle cx="41" cy="79" r="2.5" fill="#9370DB"/><circle cx="37" cy="82" r="2" fill="#8A2BE2"/><circle cx="43" cy="84" r="2" fill="#9370DB"/><circle cx="40" cy="87" r="2.5" fill="#8A2BE2"/><circle cx="38" cy="90" r="2" fill="#9370DB"/><circle cx="42" cy="92" r="2" fill="#8A2BE2"/><ellipse cx="35" cy="50" rx="1" ry="3" fill="#fff" opacity=".3"/><ellipse cx="45" cy="55" rx="1" ry="3" fill="#fff" opacity=".3"/></svg>`,
                `<svg viewBox="0 0 100 100" width="70" height="70"><defs><radialGradient id="sunflowerCenter" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#8B4513"/><stop offset="50%" stop-color="#A0522D"/><stop offset="100%" stop-color="#654321"/></radialGradient><linearGradient id="sunflowerPetal" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#FFFF99"/><stop offset="50%" stop-color="#FFD700"/><stop offset="100%" stop-color="#FFA500"/></linearGradient></defs><g transform="translate(50,50)"><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(0)"/><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(30)"/><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(60)"/><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(90)"/><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(120)"/><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(150)"/><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(180)"/><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(210)"/><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(240)"/><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(270)"/><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(300)"/><ellipse cx="0" cy="-22" rx="4" ry="12" fill="url(#sunflowerPetal)" transform="rotate(330)"/></g><circle cx="50" cy="50" r="12" fill="url(#sunflowerCenter)"/><circle cx="47" cy="47" r="1.5" fill="#654321"/><circle cx="53" cy="47" r="1.5" fill="#654321"/><circle cx="50" cy="50" r="1.5" fill="#654321"/><circle cx="47" cy="53" r="1.5" fill="#654321"/><circle cx="53" cy="53" r="1.5" fill="#654321"/></svg>`,
                `<svg viewBox="0 0 110 110" width="85" height="85"><defs><radialGradient id="poppyGrad" cx="50%" cy="50%" r="60%"><stop offset="0%" stop-color="#FFE4E1"/><stop offset="40%" stop-color="#FF6347"/><stop offset="100%" stop-color="#DC143C"/></radialGradient><radialGradient id="poppyCenter" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#000"/><stop offset="100%" stop-color="#2F4F4F"/></radialGradient></defs><path d="M55 30 Q35 20 25 45 Q20 65 45 75 Q65 80 85 65 Q90 45 70 30 Q60 25 55 30 Z" fill="url(#poppyGrad)"/><path d="M55 30 Q40 25 30 50 Q25 70 50 75 Q75 70 80 50 Q75 25 55 30 Z" fill="url(#poppyGrad)" opacity=".8" transform="rotate(20 55 52)"/><path d="M55 30 Q40 25 30 50 Q25 70 50 75 Q75 70 80 50 Q75 25 55 30 Z" fill="url(#poppyGrad)" opacity=".6" transform="rotate(-20 55 52)"/><circle cx="55" cy="52" r="8" fill="url(#poppyCenter)"/><circle cx="55" cy="52" r="4" fill="#000"/><circle cx="52" cy="49" r="1" fill="#FFD700"/><circle cx="58" cy="49" r="1" fill="#FFD700"/><circle cx="55" cy="46" r="1" fill="#FFD700"/><circle cx="52" cy="55" r="1" fill="#FFD700"/><circle cx="58" cy="55" r="1" fill="#FFD700"/></svg>`
            ];

            function createFlowerField() {
                flowerField.classList.add('show');
                
                setTimeout(() => {
                    const width = window.innerWidth * 1.1;
                    const height = window.innerHeight * 0.55;
                    const flowerCount = 500; // Уменьшено количество для лучшей производительности
                    
                    const flowersFragment = createElementsInFragment(flowerCount, 'flower', (flower, i) => {
                        flower.style.left = `${Math.random() * width - (width - window.innerWidth) / 2}px`;
                        flower.style.top = `${Math.random() * height}px`;
                        const sizeFactor = Math.random() * 0.8 + 0.4;
                        const flowerType = Math.floor(Math.random() * flowerTemplates.length);
                        
                        flower.innerHTML = flowerTemplates[flowerType];
                        
                        const svg = flower.querySelector('svg');
                        if (svg) {
                            const originalWidth = parseInt(svg.getAttribute('width'));
                            const originalHeight = parseInt(svg.getAttribute('height'));
                            svg.setAttribute('width', originalWidth * sizeFactor);
                            svg.setAttribute('height', originalHeight * sizeFactor);
                        }
                        
                        // Оптимизация: используем requestAnimationFrame для анимации
                        requestAnimationFrame(() => {
                            setTimeout(() => {
                                flower.classList.add('bloom');
                                if (Math.random() > 0.7) {
                                    setTimeout(() => {
                                        flower.classList.add('sway');
                                        flower.style.animationDelay = `${Math.random() * 2}s`;
                                    }, 800);
                                }
                            }, i * 10); // Увеличена задержка для более плавной загрузки
                        });
                    });
                    
                    flowerField.appendChild(flowersFragment);
                }, 500);
            }
            
            // Оптимизация: используем 'click' с { once: true } для одноразового события
            heart.addEventListener('click', () => {
                const message = "Пусть сон твой будет сладким и безмятежным, как летний ветерок...";
                
                // Перезапуск анимации сердца
                heart.style.animation = 'none';
                requestAnimationFrame(() => {
                    heart.style.animation = 'beat 1.2s infinite';
                });
                
                title.textContent = message;
                title.style.color = '#ff9ec0';
                
                messageElement.style.opacity = '0';
                
                createFlowerField();
                
                setTimeout(() => {
                    title.style.color = 'var(--title-color)';
                    title.textContent = 'Спокойной ночи, любимая';
                }, 3000);
            }, { once: true }); // Событие сработает только один раз

            // Удалена автоматическая смена фона через JS, так как CSS-анимация градиента уже делает это
        });
    </script>
</body>
</html>
